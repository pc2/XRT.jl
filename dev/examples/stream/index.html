<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>STREAM TRIAD Example · XRT.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">XRT.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><input class="collapse-toggle" id="menuitem-1" type="checkbox"/><label class="tocitem" for="menuitem-1"><span class="docs-label">XRT</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../">Installation</a></li><li><a class="tocitem" href="../../custom_xclbin/">XCLBIN Parsing</a></li><li><a class="tocitem" href="../../high_level/">High Level Execution</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../xrt_api/">XRT API</a></li><li><a class="tocitem" href="../high_level_basics/">Auto-generate Kernel Interface</a></li><li class="is-active"><a class="tocitem" href>STREAM TRIAD Example</a><ul class="internal"><li><a class="tocitem" href="#Implementation-Details"><span>Implementation Details</span></a></li><li><a class="tocitem" href="#Building"><span>Building</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">References</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../refs/api/">API</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>STREAM TRIAD Example</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>STREAM TRIAD Example</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/pc2/XRT.jl/blob/main/examples/stream/README.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Example:-STREAM-Benchmark"><a class="docs-heading-anchor" href="#Example:-STREAM-Benchmark">Example: STREAM Benchmark</a><a id="Example:-STREAM-Benchmark-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-STREAM-Benchmark" title="Permalink"></a></h1><p>This example contains a C++ HLS implementation of the STREAM benchmark for the DDR memory banks of the Alveo U280 board. The kernel can be used to execute all four STREAM kernels <code>copy</code>, <code>scale</code>, <code>add</code>, and <code>triad</code> by setting the input parameters accordingly.</p><h2 id="Implementation-Details"><a class="docs-heading-anchor" href="#Implementation-Details">Implementation Details</a><a id="Implementation-Details-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation-Details" title="Permalink"></a></h2><p>The signature of the HLS stream kernels looks like the following:</p><pre><code class="language-C hljs">void stream_calc(const double *in1, const double *in2, double *out,
                 const double scalar, const unsigned int number_elements,
                 const unsigned int second_input)</code></pre><p>When executed, the kernel will multiply all values in the buffer <code>in1</code> with the scalar value given in <code>scalar</code>. The array length is given by the input parameter <code>number_elements</code> and is the same for all input and output arrays. If <code>second_input</code> &gt; 0, also the second input array <code>in2</code> will be processed and added to the result of scaling array <code>in1</code>. The final result will be stored in the array <code>out</code>.</p><p>In our example code, we will execute the <code>triad</code> kernel of the STREAM benchmark and measure the total execution time of the kernel. Since we are using the high-level wrapper to create our kernel method, all buffers will be read and written to and from the FPGA before the actual kernel execution. </p><h2 id="Building"><a class="docs-heading-anchor" href="#Building">Building</a><a id="Building-1"></a><a class="docs-heading-anchor-permalink" href="#Building" title="Permalink"></a></h2><p>To execute this example, Vitis HLS needs to be installed on the system. The FPGA bitstream first has to be build using the provided Makefile.  A emulation target can be specified using the <code>TARGET</code> parameter to build for software emulation (<code>sw_emu</code>), hardware emulation (<code>hw_emu</code>), or hardware (<code>hw</code>). To build the bitstream for software emulation for the Alveo U280, run the following command:</p><pre><code class="nohighlight hljs">make all TARGET=sw_emu</code></pre><p>After successful build, the julia code can be executed:</p><pre><code class="nohighlight hljs">env XCL_EMULATION_MODE=sw_emu julia --project stream_fpga.jl</code></pre><p>The output should look similar to this:</p><pre><code class="nohighlight hljs">Kernel Name: k1, CU Number: 0, Thread creation status: success
Kernel Name: k2, CU Number: 1, Thread creation status: success
[ Info: Execute kernel test run
Kernel Name: k1, CU Number: 0, State: Start
Kernel Name: k1, CU Number: 0, State: Running
Kernel Name: k1, CU Number: 0, State: Idle
[ Info: Execute full kernel run TRIAD
Kernel Name: k1, CU Number: 0, State: Start
Kernel Name: k1, CU Number: 0, State: Running
Kernel Name: k1, CU Number: 0, State: Idle
[ Info: Execution time: 0.148555856 seconds
[ Info: Measured bandwidth: 0.5082093296948187 GB/s
[ Info: Validate output
[ Info: Done
device process sw_emu_device done
Kernel Name: k1, CU Number: 0, Status: Shutdown
Kernel Name: k2, CU Number: 1, Status: Shutdown</code></pre><p>Note, that the measured bandwidth is relatively low because software emulation is used. To execute the stream benchmark on hardware, the path to the bitstream has to be changed accordingly in the <code>@prepare_bitstream</code> line.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../high_level_basics/">« Auto-generate Kernel Interface</a><a class="docs-footer-nextpage" href="../../refs/api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Friday 6 September 2024 14:54">Friday 6 September 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
